<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
    <meta charset="utf-8">
    <title>Test</title>
    <script>

      function checkWindow(win) {
        console.log('hook win.load at', win.location.href);

        setTimeout(function() {
          console.log('window url: ', win.location.href);
        }, 500);

        win.onload = function() {
          console.log('window loaded');
          try {
            var jsonError = JSON.parse(win.document.body.innerText);
            console.log('backend gives us JSON');
          } catch (ex) {
            console.log('contains HTML');
          }
          console.log('finished');
        };
      }

      function openJSONWindow() {
        var win = window.open('test.json');
        console.log('open a window which always loads a JSON');
        checkWindow(win);
      }

      function openHTMLWindow() {
        var win = window.open('index.html');
        console.log('open a window which always loads a HTML file');
        checkWindow(win);
      }
    </script>
  </head>
  <body>
    <div>
      <button onclick="openJSONWindow()">Open a JSON window and check if it is opened correctly.</button>
      <button onclick="openHTMLWindow()">Open a HTML window and check if it is opened correctly.</button>
    </div>
  </body>

</html>
